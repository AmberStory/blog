---
title: 高性能JavaScript
date: 2019-07-04 23:09:46
tags: JavaScript Web
---
------
## JavaScript加载与执行
减少JavaScript对性能影响的方法：
* <b>`</body>`闭合标签之前，将所有`<script>`标签放在页面底部。</b>
由于浏览器在解析到<body>标签之前，不会渲染页面的任何内容，如果把script脚本放在页面顶部加载，将会导致页面明显延迟。
<br>
* <b>合并脚本</b>
页面中`<script>`标签越少，加载越快。比如下载单个100KB的文件，比下载4个25KB的文件更快，因为每一次HTTP请求都会带来额外的性能开销。虽然很多浏览器已经支持并行下载，但并行下载的文件数量有限。
<br>
* <b>使用无阻塞方式下载JavaScript</b>
    1. 带有defer、async属性的script，允许js资源与页面中的其他资源并行下载，不会阻塞浏览器其他进程。但是带有async属性的script，会在js脚本下载完成之后马上执行，此时脚本的执行会阻塞页面进程；而带有defer属性的script下载完js脚本后，会等到页面所有元素解析完成之后，onload事件处理器执行之前执行js脚本，不会阻塞页面进程。
    （注意：defer属性仅当src属性声明时才生效-------------测一测）
    2. 动态创建脚本元素
    动态创建`<script>`标签的方法，无论何时启动下载，文件的下载和执行都不会阻塞页面其他进程，但是动态加载的文件会按照从服务器返回的顺序下载和执行脚本，也就是说不一定能按照指定的顺序执行。因为浏览器对动态插入的script默认设置了async（各个浏览器可能不同），而async的执行是没有顺序的，所以我们把script标签的async属性改成false就可以了。
    （参考：http://echizen.github.io/tech/2017/04-22-script-exec）



